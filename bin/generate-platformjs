#!/bin/bash
cd "$(dirname "$(readlink -e "$0")")/.." || exit 1

echo "Downloading licence..."
curl -s https://raw.githubusercontent.com/bestiejs/platform.js/master/LICENSE.txt -o LICENSE-platform.js.txt

echo "Downloading JS..."
tmp=/tmp/platformjs-$(date +%Y%m%d-%H%M%S)-$$
curl -s https://raw.githubusercontent.com/bestiejs/platform.js/master/platform.js \
  | node_modules/.bin/uglifyjs --compress --mangle -o $tmp

name=PlatformJsSrc
tgt=core/src/main/scala-js/japgolly/scalacss/js/$name.scala
rm -f $tgt 2>/dev/null

echo "package japgolly.scalacss.js

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// NOTICE: This file is generated by $0
//
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


object $name {
  def javascript =
    "'"""'"$(cat $tmp)"'"""'"
}" > $tgt

ls -l $tgt

rm -f $tmp
